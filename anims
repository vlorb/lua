-- GUI contents
AnimButtons = {
	-- ⭐ New + prioritized emotes
	114140630538674, "AI cat dance",
	89490157555374, "Sayori",
	85361710130557, "Caramelldansen",
	76612430083861, "MM2",
	139698769473012, "Rampage 1.0",
	80199369124716, "Rampage 2.0",

	-- ⭐ Rest of your emotes
	78195344190486, "Dog Mode",
	115417853064013, "Helicopter Mode",
	85588129788692, "Hit the Griddy",
	83265734904502, "Take the L",
	129764254213842, "Gangnam Style",
	114400428765989, "180° flip",
	110146282544198, "Orange Justice",
	10714340543, "The Floss",
	109873544976020, "Biblically Accurate Emote",
	111251252458517, "California Gurls",
	97148848007002, "Russian dance",
	114687548971893, "Creepr Mode",
	106389948045296, "Floating On Clouds",
}



-- General Varibles
CursedMode = false
Player = game.Players.LocalPlayer
Mouse = Player:GetMouse()
HeaderSize = 25
PlayingId = 0
Red = Color3.new(0.9, 0, 0)
Green = Color3.new(0.26, 0.85, 0)
Grey = Color3.new(0.6, 0.6, 0.6)
Blue = Color3.new(0.26, 0.53, 0.95)

-- Setting up the GUI
ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MyAnimationHub"
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

function CreateFrame(Name)
	local Frame = Instance.new("ScrollingFrame")
	Frame.Visible = false
	Frame.Size = UDim2.new(0,213,0,300)
	Frame.BackgroundColor3 = Color3.new(0.286168, 0.286168, 0.286168)
	Frame.CanvasSize = UDim2.new(0,0,0,0)
	Frame.Name = Name
	Frame.Parent = ScreenGui
	Instance.new("UICorner", Frame)
	return Frame
end

AnimationsFrame = CreateFrame("AnimationsTabFrame")
AnimationsFrame.Visible = true
StolenAnimationsFrame = CreateFrame("StolenAnimationsTabFrame")

TabsFrame = Instance.new("Frame")
TabsFrame.Size = UDim2.new(0,20,0,300)
TabsFrame.BackgroundTransparency = 1
TabsFrame.Position = UDim2.new(0, 213,0, 0)
TabsFrame.Parent = ScreenGui

RenameBox = Instance.new("TextBox",ScreenGui)
RenameBox.Size = UDim2.new(0.3,0,0.15,0)
RenameBox.BackgroundColor3 = Color3.new(0.286168, 0.286168, 0.286168)
RenameBox.PlaceholderText = "Enter new name"
RenameBox.AnchorPoint = Vector2.new(0.5,0.5)
RenameBox.Position = UDim2.new(0.5,0,0.5,0)
RenameBox.Text = ""
RenameBox.TextScaled = true
RenameBox.RichText = true
RenameBox.Visible = false

DragBar = Instance.new("TextButton")
DragBar.Text = ""
DragBar.AutoButtonColor = false
DragBar.Position = UDim2.new(0,AnimationsFrame.AbsolutePosition.X-7.5,0, AnimationsFrame.AbsolutePosition.Y)
DragBar.Size = UDim2.new(0,230,0,25)
DragBar.BackgroundColor3 = Color3.new(0.133272, 0.133272, 0.133272)
Instance.new("UICorner").Parent = DragBar
DragBar.Position -= UDim2.new(0,0,0,25)
DragBar.Parent = ScreenGui

CloseButton = Instance.new("TextButton")
CloseButton.Text = "Close"
CloseButton.Position = UDim2.new(0,AnimationsFrame.AbsolutePosition.X-7.5,0, AnimationsFrame.AbsolutePosition.Y)
CloseButton.Size = UDim2.new(0,25,0,25)
CloseButton.BackgroundColor3 = Red
Instance.new("UICorner",CloseButton)
CloseButton.Position -= UDim2.new(0,0,0,25)
CloseButton.Parent = ScreenGui

local Title = Instance.new("TextLabel")
Title.Position = UDim2.new(0,0,0,-125)
Title.Size = UDim2.new(0,213,0,50)
Title.Name = "Title"
Title.BorderSizePixel = 0
Title.BackgroundTransparency = 1
Title.TextScaled = true
Title.TextColor = BrickColor.new("Institutional white")
Title.Text = "8greatgrandfather's OMG AWESOME Animation Hub of Pure Superbness But Only For R15 Cuz UGC Emotes Are Peak"
Instance.new("UIStroke").Parent = Title
Title.Position = UDim2.new(0,AnimationsFrame.AbsolutePosition.X,0, AnimationsFrame.AbsolutePosition.Y - Title.Size.Y.Offset*1.5)
Title.Parent = ScreenGui

-- Create anim instance
Anim = Instance.new("Animation", script)

-- General functions

function Layout(Frame)
	local Layout = Instance.new("UIListLayout", Frame)
	Layout.FillDirection = Enum.FillDirection.Horizontal
	Layout.Wraps = true
	Layout.SortOrder = Enum.SortOrder.LayoutOrder
end

function NiceButtons(Button)
	Instance.new("UICorner").Parent = Button
	local Grad = Instance.new("UIGradient")
	Grad.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.new(1,1,1)),
		ColorSequenceKeypoint.new(1, Color3.new(0.7,0.7,0.7)),
	}
	Grad.Parent = Button
end

function CreateInteractable(Size, Name, Text, Color, X, Button, Class, Tab)
	local Element = Instance.new(Class,Tab)
	if Button then
		Element.Name = Name.. "Button"
	else
		Element.Name = Name.. "Box"
	end
	if Button then
		Element.Text = Text
	else
		Element.Text = ""
		Element.PlaceholderText = Text
	end
	Element.Size = Size
	Element.TextScaled = true
	Element.RichText = true
	Element.BackgroundColor3 = Color
	NiceButtons(Element)
	return Element
end

function MassUnToggle(Button)
	for Num, Frame in ScreenGui:GetChildren() do
		if Frame:IsA("ScrollingFrame") then
			for Num, Butn in Frame:GetChildren() do
				if Butn:IsA("TextButton") and Butn ~= Button then
					Butn:SetAttribute("Toggled", false)
					Butn.BackgroundColor3 = Red
				end
			end
		end
	end
end

function CreateButton(Size,Color,Text, Name,ID, Frame, ConnectingBox, Toggled)
	local Button = CreateInteractable(Size, Name, Text, Color, 100, true, "TextButton", Frame)
	Button:SetAttribute("Toggled", Toggled)
	Button:SetAttribute("AnimId", ID)
	Frame.CanvasSize += UDim2.new(0,0,0,Size.Y.Offset)
	Button.MouseButton1Click:Connect(function()
		--if not (PlayingId == ID or PlayingId == 0) and not CursedMode then return end
		--print(ID)
		Button:SetAttribute("Toggled", not Button:GetAttribute("Toggled"))
		if Track and not CursedMode then
			Track:Stop()
		end
		if Button:GetAttribute("Toggled") then
			MassUnToggle(Button)
			PlayingId = ID
			Button.BackgroundColor3 = Green
			--print(ConnectingFrame.Text)
			PlayAnimation(ID, ConnectingBox.Text)
		else
			Button.BackgroundColor3 = Red
			PlayingId = 0
		end
	end)
	Button.MouseButton2Click:Connect(function()
		RenameBox.Text = ""
		RenameBox.Visible = true
		RenameBox:CaptureFocus()
		local function Rename()
			Button.Text = RenameBox.Text
			RenameBox.Visible = false
			Rename:Disconnect()
		end
		Rename = RenameBox.FocusLost:Connect(Rename)
	end)
	if Button.Parent == StolenAnimationsFrame then
		Button.MouseEnter:Connect(function()
			HoveringButton = Button
			HoveringBox = ConnectingBox
		end)
		Button.MouseLeave:Connect(function()
			HoveringButton = nil
			HoveringBox = ConnectingBox
		end)
	end
end

function TextboxSpeedAdjust(Box,ID)
	Box.FocusLost:Connect(function()
		if not (PlayingId == ID or PlayingId == 0 or PlayingId == StealId) and not CursedMode then return end
		if tonumber(Box.Text) == nil then
			Track:AdjustSpeed(1)
		else
			--print("Yes")
			Track:AdjustSpeed(tonumber(Box.Text))
		end
	end)
end

function CreateTextbox(Size,Color,X,Name,ID, Frame)
	local Box = CreateInteractable(Size, Name, "Play speed (default 1)", Color, 0, false, "TextBox", Frame)
	TextBoxRn = Box
	TextboxSpeedAdjust(Box,"rbxassetid://"..ID)
end

function CreateTab(Size, Name, Text, Frame)
	local Tab = CreateInteractable(Size, Name, Text, Grey, 0, true, "TextButton", TabsFrame)
	if Text == "Animations" then
		Tab.BackgroundColor3 = Green
	end
	Tab.MouseButton1Click:Connect(function()
		for Num, Tab in TabsFrame:GetChildren() do
			if Tab:IsA("TextButton") then
				Tab.BackgroundColor3 = Grey
			end
		end
		Tab.BackgroundColor3 = Green
		for Num, Frame in ScreenGui:GetChildren() do
			if Frame:IsA("ScrollingFrame") then
				Frame.Visible = false
			end
		end
		Frame.Visible = true
	end)
end

function PlayAnimation(ID,Speed)
	local Character = game.Players.LocalPlayer.Character

	Anim.AnimationId = ID
	--print(ID)

	Track = Character:WaitForChild("Humanoid"):LoadAnimation(Anim)
	Track:Play()
	Track.Looped = true
	--print(Track.Length)
	
	if tonumber(Speed) == nil then
		Track:AdjustSpeed(1)
	else
		Track:AdjustSpeed(Speed)
	end
	Track.Priority = Enum.AnimationPriority.Action
end

function CreateSearchbar(Frame)
	-- Search bar
	local Searchbar = CreateInteractable(UDim2.new(0.95,0,0,45), "Searchbar", "Search for animations", Grey, 0, false, "TextBox", Frame)
	Frame.CanvasSize += UDim2.new(0,0,0,Searchbar.Size.Y.Offset)

	-- Search bar functionality
	Searchbar.Changed:Connect(function()
		local Search = string.lower(Searchbar.Text)
		for _, Button in Frame:GetChildren() do
			if (Button:IsA("TextButton") or Button:IsA("TextBox")) and Button.Name ~= "SearchbarBox" then
				if string.find(string.lower(Button.Name), Search) then
					Button.Visible = true
				else
					Button.Visible = false
				end
			end
		end
	end)
end

function CFOAMeat(ID)
	if Track then
		Track:Stop()
	end
	PlayAnimation(ID,1)
	MassUnToggle(nil)
	StealStage = 0
	PlayingId = "Steal"
	StealId = ID
	StealButton.BackgroundColor3 = Red
end

function CheckForOwnedAnimations(ID, PlayIt)
	for Num, Frame in ScreenGui:GetChildren() do
		if Frame:IsA("ScrollingFrame") then
			for Num, Button in StolenAnimationsFrame:GetChildren() do
				if Button:GetAttribute("AnimId") == ID then
					if PlayIt then
						CFOAMeat(ID)
						Button:SetAttribute("Toggled", true)
						Button.BackgroundColor3 = Green
						--print("Play owned")
						return true
					else
						return true
					end
				end
			end
		end
	end
	if PlayIt then
		CFOAMeat(ID)
		--print("Play unowned")
	end
	return false
end

-- Give layouts
Layout(AnimationsFrame)
Layout(StolenAnimationsFrame)
Layout(TabsFrame)

-- Create tabs
NumOfTabs = 2
CreateTab(UDim2.new(0,30,0,300/NumOfTabs), "AnimationsTab", "Animations", AnimationsFrame)
CreateTab(UDim2.new(0,30,0,300/NumOfTabs), "StolenAnimationsTab", "Stolen Animations", StolenAnimationsFrame)

-- Give search bars
CreateSearchbar(AnimationsFrame)
CreateSearchbar(StolenAnimationsFrame)

-- Drag bar functionality
DragBar.MouseButton1Down:Connect(function()
	local Offset = game.Players.LocalPlayer:GetMouse().X - AnimationsFrame.AbsolutePosition.X
	while game:GetService("UserInputService"):IsMouseButtonPressed(Enum.UserInputType.MouseButton1) do
		task.wait(0.01)
		AnimationsFrame.Position = UDim2.new(0,game.Players.LocalPlayer:GetMouse().X - Offset,0,game.Players.LocalPlayer:GetMouse().Y)
		StolenAnimationsFrame.Position = AnimationsFrame.Position
		Title.Position = UDim2.new(0,AnimationsFrame.AbsolutePosition.X,0, AnimationsFrame.AbsolutePosition.Y - Title.Size.Y.Offset*1.5)
		TabsFrame.Position = AnimationsFrame.Position + UDim2.new(0, 213,0, 0)
		DragBar.Position = UDim2.new(0,AnimationsFrame.AbsolutePosition.X-7.5,0, AnimationsFrame.AbsolutePosition.Y-HeaderSize)
		CloseButton.Position = UDim2.new(0,AnimationsFrame.AbsolutePosition.X-7.5,0, AnimationsFrame.AbsolutePosition.Y-HeaderSize)
	end
end)

--Close button functionality
CloseButton.MouseButton1Click:Connect(function()
	ScreenGui:Destroy()
	script:Destroy()
end)

-- Steal button
StealId = 0
StealButton = CreateInteractable(UDim2.new(0.95,0,0,45), "StealButton", "Steal animation", Red, 100, true, "TextButton", StolenAnimationsFrame)
StolenAnimationsFrame.CanvasSize += UDim2.new(0,0,0,StealButton.Size.Y.Offset)

-- Steal button functionality
StealStage = 0
StealButton.MouseButton1Click:Connect(function()
	--if not (PlayingId == StealId or PlayingId == 0) and not CursedMode then return end
	if StealStage == 0 then
		StealStage = 1
		StealButton.BackgroundColor3 = Blue
		local Highlight = Instance.new("Highlight",workspace.Terrain)
		Highlight.FillColor = Blue
		while StealStage == 1 do
			task.wait(0.01)
			--print(StealStage)
			if Mouse.Target and Mouse.Target:FindFirstAncestorWhichIsA("Model"):FindFirstChildOfClass("Humanoid") then
				Highlight.Adornee = Mouse.Target:FindFirstAncestorWhichIsA("Model")
			else
				Highlight.Adornee = nil
			end
		end
		Highlight:Destroy()
	elseif StealStage == 1 then
		StealStage = 0
		StealButton.BackgroundColor3 = Red
	end
	--print(StealStage)
end)

-- Emergency stop button
EStopButton = CreateInteractable(UDim2.new(0.95,0,0,45), "EStopButton", "Emergency Stop", Grey, 100, true, "TextButton", AnimationsFrame)
AnimationsFrame.CanvasSize += UDim2.new(0,0,0,StealButton.Size.Y.Offset)

-- Emergency stop button functionality
EStopButton.MouseButton1Click:Connect(function()
	for Num, LocalTrack in Player.Character:WaitForChild("Humanoid"):GetPlayingAnimationTracks() do
		LocalTrack:Stop()
	end
end)

game:GetService("UserInputService").InputBegan:Connect(function(Input)
	if (Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch) and StealStage == 1 then
		local Target = Mouse.Target
		if Target and Mouse.Target:FindFirstAncestorWhichIsA("Model"):FindFirstChildOfClass("Humanoid") then
			local Humanoid = Mouse.Target:FindFirstAncestorWhichIsA("Model"):FindFirstChildOfClass("Humanoid")
			--print(#(Humanoid:GetPlayingAnimationTracks()))
			for Num, TheirTrack in Humanoid:GetPlayingAnimationTracks() do
				local ID = TheirTrack.Animation.AnimationId
				--print(Num, TheirTrack.Length ~= 0 and not CheckForOwnedAnimations(ID, true))
				if TheirTrack.Length ~= 0 and not CheckForOwnedAnimations(ID, true) then
					print(ID)
					StealStage = 0
					PlayingId = "Steal"
					StealId = ID
					StealButton.BackgroundColor3 = Red
					--local Name = game:GetService("MarketplaceService"):GetProductInfo(tonumber(Track.Animation.AnimationId:sub(14))).Name
					local animId = ID:match("%d+")
					local Name = "Animation"
					if animId then
						local info = game:GetService("MarketplaceService"):GetProductInfo(tonumber(animId))
						Name = info.Name
					else
						warn("No valid animation ID found.")
					end
					CreateTextbox(UDim2.new(0.45,0,0,45), Grey, 0, Name, ID, StolenAnimationsFrame)
					CreateButton(UDim2.new(0.45,0,0,45),Green, Name, Name, ID, StolenAnimationsFrame, TextBoxRn, true)
					break
				end
			end
		end
	end
	if Input.UserInputType == Enum.UserInputType.MouseButton3 and HoveringButton ~= nil then
		if StealId == HoveringButton:GetAttribute("AnimId") and Track ~= nil then
			Track:Stop()
		end
		print(HoveringButton.Size.Y.Offset)
		StolenAnimationsFrame.CanvasSize -= UDim2.new(0,0,0,HoveringButton.Size.Y.Offset)
		HoveringBox:Destroy()
		HoveringButton:Destroy()
	end
end)

-- Creating buttons

Counter = 0

for i=1, #AnimButtons/2 do
	CreateTextbox(UDim2.new(0.45,0,0,45), Grey, 0, AnimButtons[Counter+2], AnimButtons[Counter+1], AnimationsFrame)
	CreateButton(UDim2.new(0.45,0,0,45),Red, AnimButtons[Counter+2], AnimButtons[Counter+2], "rbxassetid://".. AnimButtons[Counter+1], AnimationsFrame, TextBoxRn, false)
	Counter += 2
end
